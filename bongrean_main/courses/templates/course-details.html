{% extends 'base.html' %} <!-- Must be the first tag -->

{% load custom_tags %} <!-- Load the custom filter at the top -->

{% block content %}
<div class="container mx-auto mt-8">
    <div class="flex flex-wrap justify-center">
        <!-- Video and Course Content Column -->
        <div class="w-full lg:w-2/3 px-4">

            <div class="relative pb-9/16 mb-4" style="padding-bottom: 0%;">
                <video controls id="courseVideo">
                    <source src="{{ MEDIA_URL }}{{ courses.first.video_file }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>

            <div class="flex justify-between items-center mb-2">
                <div class="flex items-center">
                    <img src="/{{ instructor_image }}" alt="{{ instructor_image }}" class="rounded-full w-12 h-12 mr-4">
                    <div>
                        <h5 class="text-xl font-semibold mb-0">{{ instructor }}</h5>
                        <small class="text-gray-600">Author {{ instructor_image }}</small>
                    </div>
                </div>
                <button class="bg-blue-500 text-white py-2 px-4 rounded-lg" data-toggle="modal"
                    data-target="#enrollModal">Enroll Class</button>
            </div>
            <h1 class="text-3xl font-bold mb-2">{{ course.created_at }}</h1>
            <p class="text-lg mb-4">{{ course.description }}</p>
            <hr class="mb-4">
            <!-- Comments Section -->
            <div class="mb-6">
                <h4 class="text-xl font-semibold mb-2">comments</h4>
                <!-- Comment Filter -->
                <div class="mb-2">
                    <button class="bg-red-500 text-white py-2 px-4 rounded-lg mr-2">Newest</button>
                    <button class="bg-yellow-500 text-white py-2 px-4 rounded-lg mr-2">Oldest</button>
                    <button class="bg-green-500 text-white py-2 px-4 rounded-lg mr-2">Most Liked</button>
                </div>
                <!-- Comment Form -->
                <form id="create_comment_id" action="{% url 'create_comment' lesson_id=0 %}" method="post">
                    {% csrf_token %}
                    <div class="mb-2">
                        <textarea name="content" class="w-full p-2 border rounded-lg"
                            placeholder="Write a comment..."></textarea>
                    </div>
                    <div class="mb-2"> <!-- Reduced space between post comment button and comment -->
                        <button type="submit" class="bg-purple-500 text-white py-2 px-4 rounded-lg" onclick="">Post
                            Comment</button>
                    </div>
                </form>
                <!-- Comment List -->
                <div class="space-y-2">
                    <!-- Comment Item -->
                    <div class="border p-4 rounded-lg">
                        <div class="flex items-center mb-1">
                            <img src="https://randomuser.me/api/portraits/men/1.jpg" alt=""
                                class="rounded-full w-10 h-10 mr-2">
                            <div>
                                <h5 class="text-sm font-semibold text-black">John Doe</h5>
                                <small class="text-gray-600">1 hour ago</small>
                            </div>
                        </div>
                        <p>This is a sample comment.</p>
                        <div class="flex justify-between items-center">
                            <button class="text-blue-500 hover:text-blue-700 transition duration-300">Like</button>
                            <button class="text-yellow-500 hover:text-yellow-700 transition duration-300">Reply
                                (2)</button>
                        </div>
                        <!-- Reply Section -->
                        <div class="ml-4 mt-1 mb-2">
                            <div class="border p-4 rounded-lg mb-3">
                                <div class="flex items-center mb-1">
                                    <img src="https://randomuser.me/api/portraits/women/1.jpg" alt=""
                                        class="rounded-full w-10 h-10 mr-2">
                                    <div>
                                        <h5 class="text-sm font-semibold text-black">Jane Doe</h5>
                                        <small class="text-gray-600">2 hours ago</small>
                                    </div>
                                </div>
                                <p>This is a reply to the sample comment.</p>
                            </div>
                            <div class="border p-4 rounded-lg mb-3">
                                <div class="flex items-center mb-1">
                                    <img src="https://randomuser.me/api/portraits/women/2.jpg" alt=""
                                        class="rounded-full w-10 h-10 mr-2">
                                    <div>
                                        <h5 class="text-sm font-semibold text-black">Jane Doe</h5>
                                        <small class="text-gray-600">2 hours ago</small>
                                    </div>
                                </div>
                                <p>This is another reply to the sample comment.</p>
                            </div>
                        </div>
                        <!-- Reply Form -->
                        <div class="mt-2">
                            <form action="" method="post">
                                {% csrf_token %}
                                <div class="mb-4">
                                    <textarea name="reply" class="w-full p-2 border rounded-lg"
                                        placeholder="Write a reply..."></textarea>
                                </div>
                                <button type="submit" class="bg-purple-500 text-white py-2 px-4 rounded-lg">Post
                                    Reply</button>
                            </form>
                        </div>
                    </div>
                    <!-- Comment Item -->
                    <div class="border p-4 rounded-lg">
                        <div class="flex items-center mb-2">
                            <img src="https://randomuser.me/api/portraits/women/3.jpg" alt=""
                                class="rounded-full w-10 h-10 mr-2">
                            <div>
                                <h5 class="text-sm font-semibold text-black">Jane Doe</h5>
                                <small class="text-gray-600">2 hours ago</small>
                            </div>
                        </div>
                        <p>This is another sample comment.</p>
                        <div class="flex justify-between items-center">
                            <button class="text-green-500 hover:text-green-700 transition duration-300">Like</button>
                            <button class="text-red-500 hover:text-red-700 transition duration-300">Reply (1)</button>
                        </div>
                        <!-- Reply Section -->
                        <div class="ml-4 mt-2">
                            <div class="border p-4 rounded-lg">
                                <div class="flex items-center mb-2">
                                    <img src="https://randomuser.me/api/portraits/men/2.jpg" alt=""
                                        class="rounded-full w-10 h-10 mr-2">
                                    <div>
                                        <h5 class="text-sm font-semibold text-black">John Doe</h5>
                                        <small class="text-gray-600">1 hour ago</small>
                                    </div>
                                </div>
                                <p>This is a reply to another sample comment.</p>
                            </div>
                        </div>
                        <!-- Reply Form -->
                        <div class="mt-2">
                            <form action="" method="post">
                                {% csrf_token %}
                                <div class="mb-4">
                                    <textarea name="reply" class="w-full p-2 border rounded-lg"
                                        placeholder="Write a reply..."></textarea>
                                </div>
                                <button type="submit" class="bg-purple-500 text-white py-2 px-4 rounded-lg">Post
                                    Reply</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Video Playlist Sidebar -->
        <div class="w-full lg:w-1/3 px-4 mt-8 lg:mt-0 ">
            <div class="border rounded-lg p-6 mb-8  shadow-md">
                <h4 class="text-xl font-semibold mb-4">Video Playlist</h4>
                <ul class="list-none space-y-4">
                    {% for video in courses %}
                    <li class="flex items-center border-0 border-black rounded-lg shadow-md p-4 hover:bg-gray-50">

                        <a href="{{MEDIA_URL}}{{ video.video_file }}" onclick="create_comment('{{ video.id }}')"
                            class="video-link w-full flex items-center" data-src="{{MEDIA_URL}}{{ video.video_file }}"
                            title="{{course_thumbnail.first.thumbnail}}">
                            
                            <div class="w-32 h-18 mr-4 rounded-lg shadow-md">
                                <img src="{{MEDIA_URL}}{{ course_thumbnail.first.thumbnail }}"
                                    alt="{{course_thumbnail.first.thumbnail}}"
                                    class="w-full h-full object-cover rounded-lg">
                            </div>

                            <div>
                                <span class="text-lg font-semibold">{{ video.title }}</span>
                                <span class="d-none" id="lesson_id" style="display: none;">{{video.id}}</span>
                                {% with video.duration|split_duration as duration %}
                                <p class="text-gray-600 text-xs">{{ duration.0 }} min {{ duration.1 }} sec | {{
                                    video.views }} views</p>
                                {% endwith %}
                            </div>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    // JavaScript to change video source on click
    document.querySelectorAll('.video-link').forEach(link => {
        link.addEventListener('click', function (event) {
            event.preventDefault(); // Prevent default anchor click behavior
            const videoSrc = this.getAttribute('data-src'); // Get the video source from data attribute
            document.getElementById('courseVideo').src = videoSrc; // Update video source
            document.getElementById('courseVideo').load(); // Load the video
        });
    });

    function init_url_action() {
    // Get all video links
    const videoLinks = document.querySelectorAll('.video-link');

    // If there are any video links, set the source for the first one
    if (videoLinks.length > 0) {
        const firstVideoSrc = videoLinks[0].getAttribute('data-src'); // Get the data-src of the first video link
        const videoId = document.getElementById('lesson_id').textContent; // Get the video ID from the hidden span
        console.log(videoId); // Log the video ID

        document.getElementById('courseVideo').src = firstVideoSrc; // Set the video source
        document.getElementById('courseVideo').load(); // Load the video
        create_comment(videoId);
    }
}
    init_url_action();

    function create_comment(lesson_id) {
        const form = document.getElementById('create_comment_id');

        // Replace the integer in the URL with lesson_id dynamically
        const updatedUrl = form.action.replace(/\/\d+\//, `/${lesson_id}/`);
        form.action = updatedUrl;  // Update the form action URL with the new value
    }
</script>
{% endblock %}